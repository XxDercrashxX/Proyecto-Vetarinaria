<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Paciente - VETEICA CLINIC</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="../public/css/styles.css"> 
</head>
<body>

    <header class="main-header">
        <nav class="main-nav">
            <a href="inicio.html" class="nav-logo">
                <img src="../public/css/img/logoVetica.png" alt="Veteica Clinic Logo">
            </a>
            <ul class="nav-links">
                <li><a href="inicio.html">INICIO</a></li>
                <li><a href="paciente.html" class="link-active">PACIENTE</a></li>
                <li><a href="duenos.html">DUEÑOS</a></li>
                <li><a href="citas.html">CITAS</a></li>
            </ul>
            <div class="nav-profile"><span>N</span></div>
            
            <div class="profile">
                <h3>Perfil del administrador</h3>
                <div class="profile-header">
                    <div class="profile-avatar"><span>N</span></div>
                    <strong>ejemplo</strong>
                    <p>ejemplo@gmail.com</p>
                </div>
                <div class="profile-body">
                    <label>Credencial:</label><div class="info-box">9494165149840401</div>
                    <label>Certificado:</label><div class="info-box">Veteterinario</div>
                    <label>Telefono:</label><div class="info-box">612 111 1111</div>
                </div>
                <div class="profile-footer"><a href="index.html">Cerrar sesión</a></div>
            </div>
        </nav>
    </header>

    <main class="container">
        

        <h2 class="page-title">Editar Paciente: <span id="edit-title-name">...</span></h2>

        <div class="create-form-container">
 
            <form id="editPatientForm" onsubmit="guardarCambios(event)"> 

                <div style="text-align: center; margin-bottom: 2rem;">
                    <img id="current-image" src="../public/css/img/perroInicio.png" alt="Foto actual" 
                         style="width: 200px; height: 150px; object-fit: cover; border-radius: 10px; border: 1px solid #ddd;">
                </div>

                <div class="form-group-create">
                    <label>Nombre:</label>
                    <input type="text" id="nombre" name="nombre" value="Lilo" required>
                </div>

                <div class="form-group-create">
                    <label>Especie:</label>
                    <select id="especie" name="especie">
                        <option value="perro" selected>Perro</option>
                        <option value="gato">Gato</option>
                        <option value="otro">Otro</option>
                    </select>
                </div>

                <div class="form-group-create">
                    <label>Raza:</label>
                    <input type="text" id="raza" name="raza" value="Jack rusell terryer">
                </div>

                <div class="form-group-create">
                    <label>Edad:</label>
                    <input type="number" id="edad" name="edad" value="4">
                </div>

                <div class="form-group-create">
                    <label>Sexo:</label>
                    <input type="text" id="sexo" name="sexo" value="Macho">
                </div>

                <div class="form-group-create">
                    <label>Diagnóstico Actual:</label>
                    <input type="text" id="diagnostico" name="diagnostico" value="En recuperación.">
                </div>

                <div class="form-group-create">
                    <label>Hospitalizado:</label>
                    <select id="hospitalizado" name="hospitalizado">
                        <option value="no" selected>No</option>
                        <option value="si">Sí</option>
                    </select>
                </div>

                <div class="form-group-create">
                    <label>Dueños Asociados:</label>
                    <input type="text" id="dueno" name="dueno" value="Jose herrera">
                </div>

                <div class="create-buttons">
                    <button type="submit" class="btn-form-create">Guardar cambios</button>
                    <button type="button" class="btn-form-cancel" onclick="window.location.href='paciente.html'">Cancelar</button>
                </div>

            </form>
        </div>

    </main>

    <div class="alert-overlay" id="success-alert">
        <div class="alert-box">
            <h2 class="alert-title">Cambios guardados con éxito</h2>
            <div class="alert-divider"></div>
            <button class="alert-btn-close" onclick="cerrarAlerta()">Cerrar</button>
        </div>
    </div>

    <footer class="main-footer">© 2025 Veterinaria Amor y lealtad</footer>

    <script>

        const profileIcon = document.querySelector('.nav-profile');
        const profileCard = document.querySelector('.profile');
        profileIcon.addEventListener('click', (e) => { e.stopPropagation(); profileCard.classList.toggle('active'); });
        window.addEventListener('click', (e) => { if (!profileCard.contains(e.target) && !profileIcon.contains(e.target)) { profileCard.classList.remove('active'); } });

        const params = new URLSearchParams(window.location.search);
        const petId = params.get('id');

        let pacientes = JSON.parse(localStorage.getItem('pacientesVetica')) || [];
        let pacienteActual = null;

        if (petId) {
            pacienteActual = pacientes.find(p => p.id == petId);
            
            if (pacienteActual) {

                document.getElementById('edit-title-name').innerText = pacienteActual.nombre;

                if (pacienteActual.imagen) {
                    document.getElementById('current-image').src = pacienteActual.imagen;
                }

                document.getElementById('nombre').value = pacienteActual.nombre || "";
                document.getElementById('especie').value = (pacienteActual.especie || "perro").toLowerCase();
                document.getElementById('raza').value = pacienteActual.raza || "";
                document.getElementById('edad').value = pacienteActual.edad || "";
                document.getElementById('sexo').value = pacienteActual.sexo || "";
                document.getElementById('diagnostico').value = pacienteActual.diagnostico || "";
                document.getElementById('hospitalizado').value = (pacienteActual.hospitalizado || "no").toLowerCase();
                document.getElementById('dueno').value = pacienteActual.dueno || "";
            }
        } else {

            document.getElementById('edit-title-name').innerText = "Lilo";
        }

        function guardarCambios(e) {
            e.preventDefault();

            if (pacienteActual) {

                pacienteActual.nombre = document.getElementById('nombre').value;
                pacienteActual.especie = document.getElementById('especie').value;
                pacienteActual.raza = document.getElementById('raza').value;
                pacienteActual.edad = document.getElementById('edad').value;
                pacienteActual.sexo = document.getElementById('sexo').value;
                pacienteActual.diagnostico = document.getElementById('diagnostico').value;
                pacienteActual.hospitalizado = document.getElementById('hospitalizado').value;
                pacienteActual.dueno = document.getElementById('dueno').value;

                localStorage.setItem('pacientesVetica', JSON.stringify(pacientes));

                document.getElementById('success-alert').classList.add('active');
            } else {

                 document.getElementById('success-alert').classList.add('active');
            }
        }

        function cerrarAlerta() {
            document.getElementById('success-alert').classList.remove('active');
            window.location.href = 'paciente.html';
        }
    </script>
    
</body>
</html>